{% extends "base.html" %}

{% block content %}
  <div class="space-y-6">
    <div>
      <h1 class="text-2xl font-bold">대시보드</h1>
      <p class="mt-1 text-sm text-slate-600">
        DB에 없는 데이터만 가져오고(ingest), 가져온 데이터로 추천(screen)을 생성합니다.
      </p>
    </div>

    <section class="rounded-xl border bg-white p-4">
      <div class="grid gap-3 sm:grid-cols-4">
        <div>
          <label class="text-xs text-slate-600">Market</label>
          <select id="market" class="mt-1 w-full rounded-lg border px-3 py-2 text-sm">
            <option value="ALL" selected>ALL</option>
            <option value="KOSPI">KOSPI</option>
            <option value="KOSDAQ">KOSDAQ</option>
          </select>
        </div>

        <div>
          <label class="text-xs text-slate-600">Ingest days</label>
          <input id="days" type="number" min="1" max="3650" value="120"
                 class="mt-1 w-full rounded-lg border px-3 py-2 text-sm" />
        </div>

        <div>
          <label class="text-xs text-slate-600">Top N</label>
          <input id="topN" type="number" min="1" max="200" value="50"
                 class="mt-1 w-full rounded-lg border px-3 py-2 text-sm" />
        </div>

        <div class="flex items-end gap-2">
          <button id="btnIngest"
            class="w-full rounded-lg bg-slate-900 px-3 py-2 text-sm font-semibold text-white hover:bg-slate-800">
            데이터 가져오기
          </button>
          <button id="btnScreen"
            class="w-full rounded-lg border px-3 py-2 text-sm font-semibold hover:bg-slate-50">
            추천 생성
          </button>
        </div>
      </div>

      <div class="mt-4 flex items-center gap-2">
        <div id="statusDot" class="h-2.5 w-2.5 rounded-full bg-slate-300"></div>
        <div id="statusText" class="text-sm text-slate-600">대기 중</div>
      </div>
    </section>

    <section class="grid gap-4 lg:grid-cols-2">
      <div class="rounded-xl border bg-white p-4">
        <h2 class="font-semibold">API 응답</h2>
        <pre id="result"
          class="mt-3 max-h-[520px] overflow-auto rounded-lg bg-slate-900 p-3 text-xs text-slate-100"></pre>
      </div>

      <div class="rounded-xl border bg-white p-4">
        <div class="flex items-center justify-between">
          <h2 class="font-semibold">최신 추천</h2>
          <button id="btnRefreshReco"
            class="rounded-lg border px-3 py-1.5 text-xs font-semibold hover:bg-slate-50">
            새로고침
          </button>
        </div>
        <div class="mt-3">
          <div class="text-xs text-slate-500">티커를 클릭하면 TradingView 차트가 새 탭으로 열립니다.</div>
          <div id="recoList" class="mt-2 space-y-2 text-sm"></div>
        </div>
      </div>
    </section>
  </div>
{% endblock %}

{% block scripts %}
  <script src="{{ url_for('static', path='js/pages/home.js') }}" defer></script>
{% endblock %}